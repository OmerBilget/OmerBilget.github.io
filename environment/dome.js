/*
dome is sphere surrounding to the environment
has 2 colors
horizontal color and polar color
gradially changes color 
*/

class DOME{
    vertices=[];
    faces=[];
    arraybuffer=[];
    buffer;
    program;
    constructor(translation,scale,horizoncolor,polarcolor){
        this.translation=translation;
        this.scale=scale;
        this.horizoncolor=horizoncolor;
        this.polarcolor=polarcolor;
        parseOBJvf(sphere,this,this.scale);
        this.arraybuffer=new Float32Array(createBufferArrayDome(this));
        
    }
    createBufferData(gl){
        this.buffer=gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER,this.buffer);
        gl.bufferData(gl.ARRAY_BUFFER,this.arraybuffer,gl.STATIC_DRAW);
     }
}



function createBufferArrayDome(object) {
    var bufferArray = [];
    var scale=object.scale;
    for (var i = 0; i < object.faces.length; i++) {
        for (var j = 0; j < 3; j++) {
            var tmp = object.faces[i][2-j][0]; //read reverse order because face direction must be looking towards center of sphere

            //read 3 point
            for (var k = 0; k < 3; k++) {

                bufferArray.push(object.vertices[tmp][k]);

            }
            var color=getcolor(object.vertices[tmp][1],-0.5*scale,1*scale,object.horizoncolor,object.polarcolor);
            var r=color[0];
            var g=color[1];
            var b=color[2];
            bufferArray.push(r, g, b);
        }

    }
    return bufferArray;
}


function draw_sky(gl,dome,program,identitymatrix,w,v,p,world,view,projection,pos,color){

    gl.bindBuffer(gl.ARRAY_BUFFER,dome.buffer);
 


    mat4.translate(w,identitymatrix,dome.translation);
    vec3.add(player.camera_coordinates,player.coordinate,player.lookingto);
    glMatrix.mat4.lookAt(v,player.coordinate,player.camera_coordinates,direction_up);//camera 
    gl.vertexAttribPointer(pos,3,gl.FLOAT,gl.FALSE,6*Float32Array.BYTES_PER_ELEMENT,0);
    gl.vertexAttribPointer(color,3,gl.FLOAT,gl.FALSE,6*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT);
    gl.enableVertexAttribArray(pos);
    gl.enableVertexAttribArray(color);
    gl.uniformMatrix4fv(world,gl.FALSE,w);
    gl.uniformMatrix4fv(view,gl.FALSE,v);
    gl.uniformMatrix4fv(projection,gl.FALSE,p);
    gl.drawArrays(gl.TRIANGLES,0,dome.arraybuffer.length/6);
}


function getcolor(val,min,max,mincolor,maxcolor){
    var normalize=(val-min)/(max-min);
    var color=[0,0,0];
    for(let i=0;i<3;i++){
        const difference=maxcolor[i]-mincolor[i];
        const colorval=mincolor[i]+difference*normalize;
        color[i]=colorval;
    }
    return color;
}

var sphere=
`v 0.000000 0.939693 -0.342020
v 0.000000 0.500000 -0.866025
v 0.000000 0.173648 -0.984808
v 0.000000 -0.173648 -0.984808
v 0.000000 -0.500000 -0.866025
v 0.130885 0.939693 -0.315985
v 0.245984 0.766044 -0.593858
v 0.331414 0.500000 -0.800103
v 0.376870 0.173648 -0.909844
v 0.376870 -0.173648 -0.909844
v 0.331414 -0.500000 -0.800103
v -0.000000 1.000000 -0.000000
v 0.241845 0.939693 -0.241845
v 0.454519 0.766044 -0.454519
v 0.612372 0.500000 -0.612372
v 0.696364 0.173648 -0.696364
v 0.696364 -0.173648 -0.696364
v 0.612372 -0.500000 -0.612372
v 0.315985 0.939693 -0.130885
v 0.593858 0.766044 -0.245984
v 0.800103 0.500000 -0.331414
v 0.909844 0.173648 -0.376870
v 0.909844 -0.173648 -0.376870
v 0.800103 -0.500000 -0.331414
v 0.342020 0.939693 -0.000000
v 0.642787 0.766044 -0.000000
v 0.866025 0.500000 -0.000000
v 0.984808 0.173648 -0.000000
v 0.984807 -0.173648 -0.000000
v 0.866025 -0.500000 0.000000
v 0.315985 0.939693 0.130885
v 0.593858 0.766044 0.245984
v 0.800103 0.500000 0.331414
v 0.909844 0.173648 0.376870
v 0.909843 -0.173648 0.376869
v 0.800103 -0.500000 0.331414
v 0.241845 0.939693 0.241845
v 0.454519 0.766044 0.454519
v 0.612372 0.500000 0.612372
v 0.696364 0.173648 0.696364
v 0.696364 -0.173648 0.696364
v 0.612372 -0.500000 0.612372
v 0.130885 0.939693 0.315985
v 0.245984 0.766044 0.593858
v 0.331413 0.500000 0.800103
v 0.376869 0.173648 0.909843
v 0.376869 -0.173648 0.909843
v 0.331413 -0.500000 0.800103
v -0.000000 0.939693 0.342020
v -0.000000 0.766044 0.642787
v -0.000000 0.500000 0.866025
v -0.000000 0.173648 0.984807
v -0.000000 -0.173648 0.984807
v -0.000000 -0.500000 0.866025
v -0.130885 0.939693 0.315985
v -0.245984 0.766044 0.593858
v -0.331414 0.500000 0.800103
v -0.376870 0.173648 0.909843
v -0.376870 -0.173648 0.909843
v -0.331414 -0.500000 0.800103
v -0.241845 0.939693 0.241844
v -0.454520 0.766044 0.454519
v -0.612372 0.500000 0.612372
v -0.696364 0.173648 0.696364
v -0.696364 -0.173648 0.696364
v -0.612372 -0.500000 0.612372
v -0.315985 0.939693 0.130885
v -0.593858 0.766044 0.245984
v -0.800103 0.500000 0.331413
v -0.909844 0.173648 0.376869
v -0.909844 -0.173648 0.376869
v -0.800103 -0.500000 0.331413
v -0.342020 0.939693 -0.000000
v -0.642788 0.766044 -0.000000
v -0.866025 0.500000 -0.000000
v -0.984807 0.173648 -0.000000
v -0.984807 -0.173648 -0.000001
v -0.866025 -0.500000 -0.000000
v -0.315985 0.939693 -0.130886
v -0.593858 0.766044 -0.245985
v -0.800103 0.500000 -0.331414
v -0.909843 0.173648 -0.376870
v -0.909843 -0.173648 -0.376870
v -0.800103 -0.500000 -0.331414
v -0.241845 0.939693 -0.241845
v -0.454519 0.766044 -0.454520
v -0.612372 0.500000 -0.612373
v -0.696364 0.173648 -0.696364
v -0.696364 -0.173648 -0.696364
v -0.612372 -0.500000 -0.612373
v -0.130885 0.939693 -0.315985
v -0.245984 0.766044 -0.593858
v -0.331413 0.500000 -0.800103
v -0.376869 0.173648 -0.909844
v -0.376869 -0.173648 -0.909844
v -0.331413 -0.500000 -0.800103
v 0.000000 0.766044 -0.642788
f 4/1/1 11/2/1 5/3/1
f 97/4/2 8/5/2 2/6/2
f 2/6/3 9/7/3 3/8/3
f 1/9/4 12/10/4 6/11/4
f 3/8/5 10/12/5 4/1/5
f 97/4/6 6/11/6 7/13/6
f 8/5/7 16/14/7 9/7/7
f 6/11/8 12/15/8 13/16/8
f 9/7/9 17/17/9 10/12/9
f 6/11/10 14/18/10 7/13/10
f 11/2/11 17/17/11 18/19/11
f 7/13/12 15/20/12 8/5/12
f 13/16/13 20/21/13 14/18/13
f 17/17/14 24/22/14 18/19/14
f 14/18/15 21/23/15 15/20/15
f 15/20/16 22/24/16 16/14/16
f 13/16/17 12/25/17 19/26/17
f 17/17/18 22/24/18 23/27/18
f 21/23/19 28/28/19 22/24/19
f 19/26/20 12/29/20 25/30/20
f 22/24/21 29/31/21 23/27/21
f 19/26/22 26/32/22 20/21/22
f 24/22/23 29/31/23 30/33/23
f 20/21/24 27/34/24 21/23/24
f 29/31/25 34/35/25 35/36/25
f 25/30/26 32/37/26 26/32/26
f 30/33/27 35/36/27 36/38/27
f 27/34/28 32/37/28 33/39/28
f 27/34/29 34/35/29 28/28/29
f 25/30/30 12/40/30 31/41/30
f 36/38/31 41/42/31 42/43/31
f 33/39/32 38/44/32 39/45/32
f 33/39/33 40/46/33 34/35/33
f 31/41/34 12/47/34 37/48/34
f 34/35/35 41/42/35 35/36/35
f 32/37/36 37/48/36 38/44/36
f 39/45/37 46/49/37 40/46/37
f 37/48/38 12/50/38 43/51/38
f 41/42/39 46/49/39 47/52/39
f 37/48/40 44/53/40 38/44/40
f 42/43/41 47/52/41 48/54/41
f 38/44/42 45/55/42 39/45/42
f 44/53/43 49/56/43 50/57/43
f 48/54/44 53/58/44 54/59/44
f 44/53/45 51/60/45 45/55/45
f 46/49/46 51/60/46 52/61/46
f 43/51/47 12/62/47 49/56/47
f 46/49/48 53/58/48 47/52/48
f 51/60/49 58/63/49 52/61/49
f 49/56/50 12/64/50 55/65/50
f 52/61/51 59/66/51 53/58/51
f 49/56/52 56/67/52 50/57/52
f 54/59/53 59/66/53 60/68/53
f 50/57/54 57/69/54 51/60/54
f 58/63/55 65/70/55 59/66/55
f 56/67/56 61/71/56 62/72/56
f 59/66/57 66/73/57 60/68/57
f 56/67/58 63/74/58 57/69/58
f 57/69/59 64/75/59 58/63/59
f 55/65/60 12/76/60 61/71/60
f 63/74/61 68/77/61 69/78/61
f 63/74/62 70/79/62 64/75/62
f 61/71/63 12/80/63 67/81/63
f 65/70/64 70/79/64 71/82/64
f 61/71/65 68/77/65 62/72/65
f 65/70/66 72/83/66 66/73/66
f 67/81/67 12/84/67 73/85/67
f 71/82/68 76/86/68 77/87/68
f 67/81/69 74/88/69 68/77/69
f 71/82/70 78/89/70 72/83/70
f 68/77/71 75/90/71 69/78/71
f 69/78/72 76/86/72 70/79/72
f 77/91/73 84/92/73 78/93/73
f 74/94/74 81/95/74 75/96/74
f 75/96/75 82/97/75 76/98/75
f 73/99/76 12/100/76 79/101/76
f 77/91/77 82/97/77 83/102/77
f 73/99/78 80/103/78 74/94/78
f 81/95/79 88/104/79 82/97/79
f 79/101/80 12/105/80 85/106/80
f 83/102/81 88/104/81 89/107/81
f 79/101/82 86/108/82 80/103/82
f 83/102/83 90/109/83 84/92/83
f 80/103/84 87/110/84 81/95/84
f 89/107/85 94/111/85 95/112/85
f 85/106/86 92/113/86 86/108/86
f 89/107/87 96/114/87 90/109/87
f 86/108/88 93/115/88 87/110/88
f 87/110/89 94/111/89 88/104/89
f 85/106/90 12/116/90 91/117/90
f 92/113/91 2/6/91 93/115/91
f 94/111/92 2/6/92 3/8/92
f 91/117/93 12/118/93 1/9/93
f 95/112/94 3/8/94 4/1/94
f 92/113/95 1/9/95 97/4/95
f 95/112/96 5/3/96 96/114/96
f 4/1/1 10/12/1 11/2/1
f 97/4/2 7/13/2 8/5/2
f 2/6/3 8/5/3 9/7/3
f 3/8/5 9/7/5 10/12/5
f 97/4/6 1/9/6 6/11/6
f 8/5/7 15/20/7 16/14/7
f 9/7/9 16/14/9 17/17/9
f 6/11/10 13/16/10 14/18/10
f 11/2/11 10/12/11 17/17/11
f 7/13/12 14/18/12 15/20/12
f 13/16/13 19/26/13 20/21/13
f 17/17/14 23/27/14 24/22/14
f 14/18/15 20/21/15 21/23/15
f 15/20/16 21/23/16 22/24/16
f 17/17/18 16/14/18 22/24/18
f 21/23/19 27/34/19 28/28/19
f 22/24/21 28/28/21 29/31/21
f 19/26/22 25/30/22 26/32/22
f 24/22/23 23/27/23 29/31/23
f 20/21/24 26/32/24 27/34/24
f 29/31/25 28/28/25 34/35/25
f 25/30/26 31/41/26 32/37/26
f 30/33/27 29/31/27 35/36/27
f 27/34/28 26/32/28 32/37/28
f 27/34/29 33/39/29 34/35/29
f 36/38/31 35/36/31 41/42/31
f 33/39/32 32/37/32 38/44/32
f 33/39/33 39/45/33 40/46/33
f 34/35/35 40/46/35 41/42/35
f 32/37/36 31/41/36 37/48/36
f 39/45/37 45/55/37 46/49/37
f 41/42/39 40/46/39 46/49/39
f 37/48/40 43/51/40 44/53/40
f 42/43/41 41/42/41 47/52/41
f 38/44/42 44/53/42 45/55/42
f 44/53/43 43/51/43 49/56/43
f 48/54/44 47/52/44 53/58/44
f 44/53/45 50/57/45 51/60/45
f 46/49/46 45/55/46 51/60/46
f 46/49/48 52/61/48 53/58/48
f 51/60/49 57/69/49 58/63/49
f 52/61/51 58/63/51 59/66/51
f 49/56/52 55/65/52 56/67/52
f 54/59/53 53/58/53 59/66/53
f 50/57/54 56/67/54 57/69/54
f 58/63/55 64/75/55 65/70/55
f 56/67/56 55/65/56 61/71/56
f 59/66/57 65/70/57 66/73/57
f 56/67/58 62/72/58 63/74/58
f 57/69/59 63/74/59 64/75/59
f 63/74/61 62/72/61 68/77/61
f 63/74/62 69/78/62 70/79/62
f 65/70/64 64/75/64 70/79/64
f 61/71/65 67/81/65 68/77/65
f 65/70/66 71/82/66 72/83/66
f 71/82/68 70/79/68 76/86/68
f 67/81/69 73/85/69 74/88/69
f 71/82/70 77/87/70 78/89/70
f 68/77/71 74/88/71 75/90/71
f 69/78/72 75/90/72 76/86/72
f 77/91/73 83/102/73 84/92/73
f 74/94/74 80/103/74 81/95/74
f 75/96/75 81/95/75 82/97/75
f 77/91/77 76/98/77 82/97/77
f 73/99/78 79/101/78 80/103/78
f 81/95/79 87/110/79 88/104/79
f 83/102/81 82/97/81 88/104/81
f 79/101/82 85/106/82 86/108/82
f 83/102/83 89/107/83 90/109/83
f 80/103/84 86/108/84 87/110/84
f 89/107/85 88/104/85 94/111/85
f 85/106/86 91/117/86 92/113/86
f 89/107/87 95/112/87 96/114/87
f 86/108/88 92/113/88 93/115/88
f 87/110/89 93/115/89 94/111/89
f 92/113/91 97/4/91 2/6/91
f 94/111/92 93/115/92 2/6/92
f 95/112/94 94/111/94 3/8/94
f 92/113/95 91/117/95 1/9/95
f 95/112/96 4/1/96 5/3/96
`;